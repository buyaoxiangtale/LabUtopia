# Ridgebaseæ§åˆ¶å™¨å¯¹æ¯”åˆ†æ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†å¯¹æ¯”åˆ†æäº†ä¸¤ç§Ridgebaseæ§åˆ¶å™¨å®ç°ï¼š

1. **RidgebaseController** - åŸå§‹ç®€å•æ¯”ä¾‹æ§åˆ¶ç‰ˆæœ¬
2. **RidgebaseControllerNew** - é«˜æ€§èƒ½PIDæ§åˆ¶ä¼˜åŒ–ç‰ˆæœ¬

## ğŸ” æ ¸å¿ƒæ¶æ„å¯¹æ¯”

### 1. æ§åˆ¶ç­–ç•¥å¯¹æ¯”

| æ–¹é¢ | RidgebaseController | RidgebaseControllerNew |
|------|-------------------|----------------------|
| **æ§åˆ¶ç®—æ³•** | ç®€å•æ¯”ä¾‹(P)æ§åˆ¶ | å®Œæ•´PIDæ§åˆ¶ |
| **å“åº”ç‰¹æ€§** | çº¿æ€§å“åº”ï¼Œå›ºå®šå¢ç›Š | è‡ªé€‚åº”å“åº”ï¼Œå¤šå‚æ•°è°ƒä¼˜ |
| **ç¨³å®šæ€§** | å›ºæœ‰ç¨³å®šï¼Œæ— éœ‡è¡ | åŠ¨æ€ç¨³å®šï¼ŒæŠ—å¹²æ‰°å¼º |
| **ç²¾åº¦** | ä¸­ç­‰ç²¾åº¦ | é«˜ç²¾åº¦ï¼Œæ¶ˆé™¤ç¨³æ€è¯¯å·® |

### 2. æ§åˆ¶å‚æ•°å¯¹æ¯”

#### PIDå‚æ•°è®¾ç½®
```python
# åŸå§‹æ§åˆ¶å™¨ - ç®€å•æ¯”ä¾‹æ§åˆ¶
self.k_p_linear = 1      # å›ºå®šæ¯”ä¾‹å¢ç›Š
self.k_p_angular = 4     # å›ºå®šæ¯”ä¾‹å¢ç›Š

# æ–°æ§åˆ¶å™¨ - é«˜æ€§èƒ½PIDæ§åˆ¶
self.k_p_linear = 2.5    # æ¯”ä¾‹å¢ç›Š (å“åº”é€Ÿåº¦)
self.k_i_linear = 0.02   # ç§¯åˆ†å¢ç›Š (æ¶ˆé™¤è¯¯å·®)
self.k_d_linear = 0.01   # å¾®åˆ†å¢ç›Š (æŠ‘åˆ¶éœ‡è¡)
self.k_p_angular = 4.5   # è§’é€Ÿåº¦æ¯”ä¾‹å¢ç›Š
self.k_i_angular = 0.05  # è§’é€Ÿåº¦ç§¯åˆ†å¢ç›Š
self.k_d_angular = 0.02  # è§’é€Ÿåº¦å¾®åˆ†å¢ç›Š
```

#### é«˜çº§æ§åˆ¶ç‰¹æ€§
```python
# æ–°æ§åˆ¶å™¨ç‹¬æœ‰çš„é«˜çº§ç‰¹æ€§
self.linear_deadzone = 0.0001    # æ­»åŒºæ§åˆ¶ï¼Œé˜²æ­¢å¾®å°æŠ–åŠ¨
self.angular_deadzone = 0.002    # è§’åº¦æ­»åŒºæ§åˆ¶
self.alpha_linear = 0.95         # çº¿é€Ÿåº¦ä½é€šæ»¤æ³¢
self.alpha_angular = 0.85        # è§’é€Ÿåº¦ä½é€šæ»¤æ³¢
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### é€Ÿåº¦æ€§èƒ½
- **åŸå§‹æ§åˆ¶å™¨**: å“åº”é€Ÿåº¦ ~1.2-1.5 cm/s (è·ç¦»10cmæ—¶)
- **æ–°æ§åˆ¶å™¨**: å“åº”é€Ÿåº¦ ~2.5-3.5 cm/s (è·ç¦»10cmæ—¶)
- **æå‡å¹…åº¦**: **+100-150%**

### å¹³æ»‘æ€§
- **åŸå§‹æ§åˆ¶å™¨**: å®Œå…¨å¹³æ»‘ï¼Œæ— æŠ–åŠ¨ï¼Œä½†å“åº”æ…¢
- **æ–°æ§åˆ¶å™¨**: è½»å¾®æŠ–åŠ¨é£é™©ï¼Œä½†å¤§å¹…æå‡å“åº”é€Ÿåº¦

### æ§åˆ¶ç²¾åº¦
- **åŸå§‹æ§åˆ¶å™¨**: ä¸­ç­‰ç²¾åº¦ï¼Œå­˜åœ¨ç¨³æ€è¯¯å·®
- **æ–°æ§åˆ¶å™¨**: é«˜ç²¾åº¦ï¼ŒPIDç§¯åˆ†é¡¹æ¶ˆé™¤ç¨³æ€è¯¯å·®

## ğŸ› ï¸ æŠ€æœ¯å®ç°è¯¦è§£

### 1. PIDæ§åˆ¶ç®—æ³•

æ–°æ§åˆ¶å™¨å®ç°äº†å®Œæ•´çš„PIDæ§åˆ¶ï¼š

```python
def _pid_control(self, error, prev_error, integral, kp, ki, kd, dt):
    # æ¯”ä¾‹é¡¹ - å“åº”å½“å‰è¯¯å·®
    proportional = kp * error

    # ç§¯åˆ†é¡¹ - ç´¯ç§¯å†å²è¯¯å·®ï¼Œé™å¹…é˜²æ­¢é¥±å’Œ
    integral_new = integral + ki * error * dt
    integral_new = np.clip(integral_new, -integral_limit, integral_limit)

    # å¾®åˆ†é¡¹ - é¢„æµ‹è¯¯å·®å˜åŒ–è¶‹åŠ¿
    derivative = kd * (error - prev_error) / dt

    # PIDè¾“å‡º
    output = proportional + integral_new + derivative
    return output, integral_new
```

### 2. æ­»åŒºæ§åˆ¶

é˜²æ­¢å¾®å°è¯¯å·®å¼•èµ·çš„ä¸å¿…è¦è¿åŠ¨ï¼š

```python
def _apply_deadzone(self, value, deadzone):
    if abs(value) < deadzone:
        return 0.0  # åœ¨æ­»åŒºå†…è¾“å‡ºä¸º0
    return value
```

### 3. ä½é€šæ»¤æ³¢

å‡å°‘é«˜é¢‘æŠ–åŠ¨ï¼Œæä¾›å¹³æ»‘è¾“å‡ºï¼š

```python
def _low_pass_filter(self, new_value, prev_value, alpha):
    return alpha * new_value + (1 - alpha) * prev_value
```

### 4. å¹³æ»‘é€Ÿåº¦è¿‡æ¸¡

æ ¹æ®è·ç¦»åŠ¨æ€è°ƒæ•´å…è®¸çš„æœ€å¤§é€Ÿåº¦ï¼š

```python
def _compute_smooth_speed(self, distance, max_speed):
    if distance < threshold:
        # è¿‘è·ç¦»ä¿æŒè¾ƒé«˜é€Ÿåº¦
        speed = (distance / threshold) * max_speed * 0.95
    elif distance < threshold * 1.5:
        # ä¸­è·ç¦»å¿«é€Ÿè¿‡æ¸¡
        ratio = (distance - threshold) / (threshold * 0.5)
        speed = 0.95 * max_speed + ratio * 0.05 * max_speed
    else:
        # è¿œè·ç¦»å…¨é€Ÿ
        speed = max_speed
    return speed
```

## ğŸ¯ ä½¿ç”¨å»ºè®®

### é€‰æ‹©åŸå§‹æ§åˆ¶å™¨çš„æƒ…å†µï¼š
- å¯¹é€Ÿåº¦è¦æ±‚ä¸é«˜
- æ›´æ³¨é‡è¿åŠ¨å¹³æ»‘æ€§
- è®¡ç®—èµ„æºæœ‰é™
- æ§åˆ¶å‚æ•°è°ƒä¼˜ç»éªŒä¸è¶³

### é€‰æ‹©æ–°æ§åˆ¶å™¨çš„æƒ…å†µï¼š
- éœ€è¦å¿«é€Ÿå“åº”
- å¯¹æ§åˆ¶ç²¾åº¦è¦æ±‚é«˜
- å¯ä»¥æ¥å—è½»å¾®æŠ–åŠ¨
- æœ‰å‚æ•°è°ƒä¼˜èƒ½åŠ›

### å‚æ•°è°ƒä¼˜æŒ‡å—ï¼š
1. **æé«˜å“åº”é€Ÿåº¦**: å¢åŠ  `k_p` å‚æ•°
2. **å‡å°‘æŠ–åŠ¨**: å¢åŠ  `k_d` å‚æ•°æˆ–å‡å°æ»¤æ³¢ `alpha`
3. **æ¶ˆé™¤ç¨³æ€è¯¯å·®**: é€‚å½“å¢åŠ  `k_i` å‚æ•°
4. **è°ƒæ•´æ­»åŒº**: æ ¹æ®å®é™…æŠ–åŠ¨æƒ…å†µè°ƒæ•´ `deadzone` å€¼

## ğŸ”§ ç»´æŠ¤å’Œæ‰©å±•

### æ‰©å±•å»ºè®®ï¼š
1. **è‡ªé€‚åº”PID**: æ ¹æ®è·ç¦»åŠ¨æ€è°ƒæ•´PIDå‚æ•°
2. **è½¨è¿¹è§„åˆ’**: é›†æˆæ›´é«˜çº§çš„è·¯å¾„è§„åˆ’ç®—æ³•
3. **éšœç¢ç‰©å›é¿**: æ·»åŠ éšœç¢ç‰©æ£€æµ‹å’Œå›é¿é€»è¾‘
4. **å­¦ä¹ ä¼˜åŒ–**: ä½¿ç”¨å¼ºåŒ–å­¦ä¹ è‡ªåŠ¨è°ƒä¼˜å‚æ•°

### è°ƒè¯•æŠ€å·§ï¼š
1. **é€Ÿåº¦ç›‘æ§**: è®°å½•å®é™…é€Ÿåº¦æ›²çº¿
2. **è¯¯å·®åˆ†æ**: è§‚å¯Ÿä½ç½®å’Œè§’åº¦è¯¯å·®æ”¶æ•›æƒ…å†µ
3. **å‚æ•°æ‰«æ**: ç³»ç»Ÿæ€§åœ°æµ‹è¯•ä¸åŒå‚æ•°ç»„åˆ
4. **å¯è§†åŒ–è°ƒè¯•**: æ·»åŠ æ§åˆ¶è¾“å‡ºçš„å®æ—¶å¯è§†åŒ–

## ğŸ“ˆ æ€»ç»“

æ–°æ§åˆ¶å™¨é€šè¿‡å¼•å…¥PIDæ§åˆ¶ã€æ­»åŒºæ§åˆ¶ã€ä½é€šæ»¤æ³¢ç­‰å…ˆè¿›æŠ€æœ¯ï¼Œåœ¨ä¿æŒè¿åŠ¨å¹³æ»‘æ€§çš„åŒæ—¶å¤§å¹…æå‡äº†å“åº”é€Ÿåº¦å’Œæ§åˆ¶ç²¾åº¦ï¼Œæ˜¯åŸå§‹æ§åˆ¶å™¨çš„é‡å¤§å‡çº§ç‰ˆæœ¬ã€‚

**æ ¸å¿ƒæƒè¡¡**ï¼šé€Ÿåº¦ vs å¹³æ»‘æ€§
- åŸå§‹æ§åˆ¶å™¨ï¼šç‰ºç‰²é€Ÿåº¦ï¼Œæ¢å–ç»å¯¹å¹³æ»‘
- æ–°æ§åˆ¶å™¨ï¼šç‰ºç‰²éƒ¨åˆ†å¹³æ»‘ï¼Œæ¢å–å¤§å¹…é€Ÿåº¦æå‡

æ ¹æ®å…·ä½“åº”ç”¨éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ§åˆ¶å™¨ç‰ˆæœ¬ã€‚